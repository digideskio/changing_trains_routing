<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" lang="en"></meta>
  <title>Umsteigematrix im Bahnhof</title>
  <script src="http://openlayers.org/api/2.13.1/OpenLayers.js"></script> 
  <script src="http://overpass-api.de/OpenStreetMap.js"></script>
  <script src="draw_latlon_markers.js"></script>
  <script type="text/javascript">
  
  function init()
  {
    DrawLatLonMarkers.init_map(45, -110, 10);
    DrawLatLonMarkers.draw_point(50.8, 7.1);
    DrawLatLonMarkers.draw_point(51.2, 7.2);
    DrawLatLonMarkers.adjust_map();
  }
  
  function show_station(station)
  {
    if (!station)
      alert("Internal error: station data is empty.");
    if (station.name)
      alert("station has name " + station.name);
    if (station.station_id)
      alert("station has id " + station.station_id);
  }
    
  function load_data()
  {
    var station_name = "";
    var station_name_field = document.getElementById("station_name");
    if (station_name_field && station_name_field.value)
      station_name = station_name_field.value;
    
    function xhreqCallback()
    {
      if (this.readyState == 4)
      {
        if (this.status == 200)
          show_station(JSON.parse(this.responseText));
        else
          alert(this.statusText);
      }
          
      DrawLatLonMarkers.draw_trace([{lat: 50.8, lon: 7.1}, {lat: 51.2, lon: 7.2}, {lat: 52, lon: 7.5}]);
      DrawLatLonMarkers.adjust_map();
    }
          
    var xhreq = new XMLHttpRequest();
    if (xhreq == null)
        alert("Browser not supported (the browser doesn't have XMLHttpRequest). "
            + "Please use instead e.g. a recent Firefox version.");
    
    xhreq.open("GET", "/adam/api/matrix?name=" + station_name, true);
    xhreq.onreadystatechange = xhreqCallback;
    xhreq.send(null);    
  }

  </script>
</head>
<body onload="init()">

<div style="position:absolute; top:0%; left:0%; height:100%; width:30%; z-index:1">
    <div style="height:20%">
        <form action="#" acceptCharset="UTF-8">
            <input type="text" id="station_name" value=""></input>
            <input type="submit" value="Fetch data" onclick="load_data()"></input>
        </form>  
        <strong id="status">&nbsp;</strong>
    </div>
    <div id="textual_results" style="height:90%; overflow-y:scroll"></div>
</div>
<div id="map" class="smallmap" style="position:absolute; top:0%; left:30%; height:100%; width:70%; z-index:1"></div>

</body>
</html>
